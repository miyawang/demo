<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <script>
    // 闭包 + 缓存：
    // 1 使用闭包，为了保护缓存对象
    // 2 缓存：为了记录已经计算过的数据

    /* var count = 0
    function fib(num) {
      count++
      if (num === 0 || num === 1) {
        return 1
      }
      return fib(num - 1) + fib(num - 2)
    }
    fib(10)
    console.log(count) */

    var count = 0
    
    // 外层函数fn是为了形成闭包，保护 缓存对象cache
    function fn() {
      // 缓存对象
      // 键：要计算的索引号
      // 值：索引号对应的计算后的值
      var cache = {}
      
      // 内部函数用于实现递归计算菲波那契数列
      return function fib (num) {
        count++
        // 1 判断缓存中有没有数据
        if (num in cache) {
          // 缓存中有
          return cache[num]
        }

        // 2 如果没有
        //  先计算
        //  再存到缓存中
        if (num === 0 || num === 1) {
          cache[num] = 1
          return 1
        }

        cache[num] = fib(num - 1) + fib(num - 2)
        return cache[num]
      }
    }

    var fib = fn()
    // var ret = fib(20)
    // console.log(ret)
    var r = fib(1000)
    console.log(count, r)

    // 计算索引号为：20 的值，代码执行了： 21891次 / 39次
    // 计算索引号为：21 的值，代码执行了： 35421次 / 41次
    // ...
    // 计算索引号为：40 的值，代码执行了： 331160281次 / 79次
    // 计算索引号为：50 的值，代码执行了： 400亿+次 / 99次
    // 计算索引号为：1000 的值，代码执行了： n亿+次 / 1999次

  </script>
</body>

</html>