<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <script>
    // 问题：
    // for 会执行：10次
    // 每次for循环中都有一个 setTimeout
    // 所以，将来会打印10次

    // 打印结果是什么？？？
    // 1 for 的代码是会被立即执行的（主线程）
    // 2 10个setTimeout中的回调函数是延后执行的
    // 代码执行顺序：先执行10次for循环，等到for执行完成，再执行回调函数中的代码
    // for (var i = 0; i < 10; i++) {
    //   setTimeout(function () {
    //     console.log(i)
    //   }, 0)
    // }
    // console.log('for循环中的i为：', i)

    /* var i
    for (i = 0; i < 10; i++) {
      setTimeout(function () {
        console.log(i)
      }, 0)
    }
    console.log('for循环中的i为：', i) */

    // 问题2：如何打印 0-9 ？？？ 闭包
    // 我们发现，直接进行for循环，能够正确打印出 0-9
    // 所以，我们只要能够每次循环的i值，保存起来，然后，在定时器中一个个取出来就能打印出0-9了
    // 1 
    /* for (i = 0; i < 10; i++) {
      // console.log(i)
      function fn(n) {
        var num = n
        console.log(num)
      }

      fn(i)
    } */
    
    // 2 
    /* for (i = 0; i < 10; i++) {
      function fn(n) {
        var num = n
        
        return function () {
          console.log(num)
        }
      }

      var f = fn(i)
      f()
    } */

    // 遍历的过程中，产生了 10 个闭包
    // 每个闭包中 num 的值为：0 1 2 。。。9
    // 所以，在定时器中调用返回函数f的时候，会分别把自己对应闭包中保存的 num 值取出来，并且打印
    // 3
    /* for (i = 0; i < 10; i++) {
      function fn(n) {
        var num = n

        return function () {
          console.log(num)
        }
      }

      var f = fn(i)
      setTimeout(f, 100 * i)
    } */

    // 代码优化:
    for (i = 0; i < 10; i++) {
      setTimeout(function fn(n) {
        return function () {
          console.log(n)
        }
      }(i), 100 * i)
    }
    
    
    // 分解 for 循环,过程分析:
    /* // for循环第一次：
    function fn(n) {
      var num = 0

      return function () {
        console.log(0)
      }
    }

    var f = fn(0)
    setTimeout(f, 100 * i)

    // for循环第一次：
    function fn(n) {
      var num = 1

      return function () {
        console.log(1)
      }
    }

    var f = fn(1)
    setTimeout(f, 100 * i) */
  </script>
</body>

</html>